<!DOCTYPE html><html lang="[&quot;zh-cn&quot;,&quot;en-us&quot;,&quot;default&quot;]" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>14.WLAN基础 | 元立'Blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"复制"}}</script><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('/img/edge_background.jpg');
 --light-background: url('/img/edge_background.jpg');
 --theme-encrypt-confirm: '确认'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async src="/js/gitalk.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@9.2.2/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'Ov23li6l7Vha6J97w6g2',
 clientSecret: '44a954ab2d9b330a8dd107ffcdde96008b1b8599',
 repo: 'Gittalk-blog',
 owner: 'LongFengShuanWu',
 admin: ['LongFengShuanWu'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.busuanzi'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);document.addEventListener('pjax:success', _ => bszCaller.fetch(
 "//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback", a => {
  bszTag.texts(a),
  bszTag.shows()
}));reset()})</script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'Ov23li6l7Vha6J97w6g2',
 clientSecret: '44a954ab2d9b330a8dd107ffcdde96008b1b8599',
 repo: 'Gittalk-blog',
 owner: 'LongFengShuanWu',
 admin: ['LongFengShuanWu'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem"><a class="navBlock" href="/Link-Portals/"><span class="navItemTitle">Link-Portals</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>14.WLAN基础</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-11-14T07:00:10.000Z" id="date"> 2023-11-14</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-11-24T07:19:46.000Z" id="updated"> 2023-11-24</time></div></span><br><span id="busuanzi_container_page_pv">页面浏览: <span class="control" id="busuanzi_value_page_pv">加载中...</span></span></div></div><hr><div id="post-content"><h1 id="组网概念"><a href="#组网概念" class="headerlink" title="组网概念"></a>组网概念</h1><ol>
<li><p>二层组网：<br>AP 与 AC 处于相同的广播域中，可以通过二层广播的方式进行连接（一般相同 VLAN 和相同网段）<br>适合于中小型的网络，AP 数量较少</p>
</li>
<li><p>三层组网：<br>AP 与 AC 处于三层网络（一般隔离广播域或者地理位置，需要通过路由器或交换设备三层互联）<br>AP 与 AC 之间需要通过可达的单播路由传递数据（跨 VLAN 和不同网段的组网）<br>适合于大型组网，AP 数量较多且分布在不同的接入交换设备上</p>
</li>
<li><p>直通连接<br>AC 在数据的转发路径上（参与数据转发）</p>
</li>
<li><p>旁挂连接<br>AC 不参与数据转发，连接在核心或汇聚交换机上，只提供 AP 管理和用户信息认证等功能</p>
</li>
</ol>
<h1 id="工作过程"><a href="#工作过程" class="headerlink" title="工作过程"></a>工作过程</h1><h2 id="1-AP-与-AC-建立-CAPWAP-隧道"><a href="#1-AP-与-AC-建立-CAPWAP-隧道" class="headerlink" title="1. AP 与 AC 建立 CAPWAP 隧道"></a>1. AP 与 AC 建立 CAPWAP 隧道</h2><p>隧道用于 AC 与 AP 之间传输控制信息（配置命令、状态检测报文、用户上线等信息）<br>也可以通过隧道转发的方式，由 AP 与 AC 之间的隧道转发用户数据
	</p>
<h3 id="1-AP-设备需要先通过-DHCP-服务器或者-IP-地址信息"><a href="#1-AP-设备需要先通过-DHCP-服务器或者-IP-地址信息" class="headerlink" title="1.  AP 设备需要先通过 DHCP 服务器或者 IP 地址信息"></a>1.  AP 设备需要先通过 DHCP 服务器或者 IP 地址信息</h3><p>（在 AP 接入的交换机上配置 DHCP 地址池）</p>
<h4 id="配置命令：（接入交换设备）"><a href="#配置命令：（接入交换设备）" class="headerlink" title="配置命令：（接入交换设备）"></a>配置命令：（接入交换设备）</h4><ol>
<li>开启 DHCP 服务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">dhcp enable <br></code></pre></td></tr></table></figure>
<ol start="2">
<li>配置地址池（全局接口）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vlan  10				// 创建管理 VLAN 10<br>interface  VLANIF 10<br>ip address  192.168.10.254  24	// 网关地址及地址池范围<br>dhcp select  interface 		// 开启接口地址池模式<br>dhcp server excluded-ip-address 192.168.10.100		（排除 AC 设备的 IP 地址）<br></code></pre></td></tr></table></figure>
<h3 id="2-交换机连接-AP-的接口需要放行相关-VLAN，保证接入的-AP-设备能够获取到-IP-地址"><a href="#2-交换机连接-AP-的接口需要放行相关-VLAN，保证接入的-AP-设备能够获取到-IP-地址" class="headerlink" title="2.  交换机连接 AP 的接口需要放行相关 VLAN，保证接入的 AP 设备能够获取到 IP 地址"></a>2.  交换机连接 AP 的接口需要放行相关 VLAN，保证接入的 AP 设备能够获取到 IP 地址</h3><p>（如：DHCP 服务器在 VLANIF 10，交换机的接口需要放行 VLAN 10 并且配置 PVID 10）</p>
<h4 id="配置命令：进入（LSW-与-AP-连接的接口）"><a href="#配置命令：进入（LSW-与-AP-连接的接口）" class="headerlink" title="配置命令：进入（LSW 与 AP 连接的接口）"></a>配置命令：进入（LSW 与 AP 连接的接口）</h4><ol>
<li>进入接口</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">interface  G0/0/X<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>放行 VLAN 以及配置 PVID</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">port link-type  trunk<br>port trunk allow-pass  vlan  10	（允许管理 VLAN 通，让 AP 获取 IP 地址）<br>port trunk pvid vlan 10		// 因为 AP 发出的数据帧不带标签，需要向 VLANIF 10 获取 IP 地址，必须添加 VLAN 10 的标签<br>							（收到一个不带标签的数据帧，设备会根据 PVID 打上标签）<br></code></pre></td></tr></table></figure>
<ul>
<li>查看：在 AP 设备上</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">display  ip  interface  brief   	// 查看 AP 是否获取到 IP 地址（如果没有检测以上的配置命令，如果配置无误，则重启 AP）<br></code></pre></td></tr></table></figure>
<h3 id="3-AC-设备需要手工配置-IP-地址（如：二层组网）则在-VLANIF-10-中配置相同网段的-IP-地址并且AC、交换机以及与-AP-互联的端口都要放行-VLAN-10（保障-AP-能与-AC-通信）"><a href="#3-AC-设备需要手工配置-IP-地址（如：二层组网）则在-VLANIF-10-中配置相同网段的-IP-地址并且AC、交换机以及与-AP-互联的端口都要放行-VLAN-10（保障-AP-能与-AC-通信）" class="headerlink" title="3. AC 设备需要手工配置 IP 地址（如：二层组网）则在 VLANIF 10 中配置相同网段的 IP 地址并且AC、交换机以及与 AP 互联的端口都要放行 VLAN 10（保障 AP 能与 AC 通信）"></a>3. AC 设备需要手工配置 IP 地址（如：二层组网）则在 VLANIF 10 中配置相同网段的 IP 地址并且AC、交换机以及与 AP 互联的端口都要放行 VLAN 10（保障 AP 能与 AC 通信）</h3><h4 id="配置命令：（AC）"><a href="#配置命令：（AC）" class="headerlink" title="配置命令：（AC）"></a>配置命令：（AC）</h4><ol>
<li>创建通信接口</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vlan 10<br>interface vlanif 10<br>192.168.10.100  24			// 在 AC 上配置 VLAN 及 IP 地址<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>进入 AC 与 LSW 互联的接口，放行 VLAN 10</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">interface G0/0/X<br>port link-type  trunk<br>port trunk allow-pass  vlan  10	（允许管理 VLAN 10 通过，使得 AC 与 AP 能够通信）<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>进入 LSW 与 AC 互联的接口，反向也需要放行 VLAN 10</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">interface G0/0/X<br>port link-type  trunk<br>port trunk allow-pass  vlan  10	（允许管理 VLAN 10 通过，使得 AC 与 AP 能够通信）<br></code></pre></td></tr></table></figure>
<ul>
<li>测试：使用 AP ping AC，或 AC ping AP 能通信即可，如果无法通信，检测接口的 VLAN 是否放行</li>
</ul>
<h3 id="4-AC-设备设置-CAPWAP-的隧道源-IP-地址（或者接口）用于-AC-与-AP-之间通信"><a href="#4-AC-设备设置-CAPWAP-的隧道源-IP-地址（或者接口）用于-AC-与-AP-之间通信" class="headerlink" title="4. AC 设备设置 CAPWAP 的隧道源 IP 地址（或者接口）用于 AC 与 AP 之间通信"></a>4. AC 设备设置 CAPWAP 的隧道源 IP 地址（或者接口）用于 AC 与 AP 之间通信</h3><h4 id="配置命令：（AC）-1"><a href="#配置命令：（AC）-1" class="headerlink" title="配置命令：（AC）"></a>配置命令：（AC）</h4><p>1. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">capwap source ip-address 192.168.10.100	（指定 AC 与 AP 能够互通的 IP 地址）	<br></code></pre></td></tr></table></figure>
<ol start="5">
<li>AP 上线（AC 需要对 AP 的身份做认证，默认为：MAC 认证）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">wlan						// 进入 WLAN 视图<br>ap-id 1 ap-mac  XXXX-XXXX-XXXX			// 把 AP 的 MAC 地址绑定到 AP-ID 1 中<br></code></pre></td></tr></table></figure>
<ul>
<li>查看 AP 是否上线，AC 上</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">display  ap   all			// 状态为 nor（代表上线成功）<br></code></pre></td></tr></table></figure>


<h2 id="2-AC-可以通过-VAP-的配置，向-AP-下发配置命令和控制信息"><a href="#2-AC-可以通过-VAP-的配置，向-AP-下发配置命令和控制信息" class="headerlink" title="2. AC 可以通过 VAP 的配置，向 AP 下发配置命令和控制信息"></a>2. AC 可以通过 VAP 的配置，向 AP 下发配置命令和控制信息</h2><h3 id="AC-下发配置信息"><a href="#AC-下发配置信息" class="headerlink" title="AC 下发配置信息"></a>AC 下发配置信息</h3><ol>
<li>进入 WLAN 配置（服务集、安全、VAP 模板）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">wlan<br>ssid-profile  name A				// 进入 WLAN 视图，创建 SSID 模板（A）<br>ssid  Offiec					// 设置服务集名称（Offiec）<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>设置安全模板</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">security-profile name A				// 创建安全模板，名称：A<br>security wpa2 psk pass-phrase 12345678 aes		// 密码为：12345678 使用 wpa2 认证，aes 加密<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>绑定模板到 VAP 中</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vap-profile name A					// 创建 VAP 模板，名称 A<br>service-vlan vlan-id 20				// 指定服务 VLAN（与管理 VLAN 隔离，默认使用管理 VLAN 分配 IP 地址）<br>ssid-profile A					// 把 Office 和密码 12345678 绑定在 VAP A 中<br>security-profile A<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>调用 VAP</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ap-id  1						// 进入 AP 1 设备<br>vap-profile  A wlan  1 radio 0				// 调用 VAP A，使用 WLAN ID=1，频道为：2.4GHZ（1和2都为 5GHZ）<br></code></pre></td></tr></table></figure>
<ul>
<li>如果出现信号圈，代表配置完成，否则查看以上配置是否缺漏，或者存在错误</li>
</ul>
<h1 id="三层组网（AC-与-AP-处于不同网段，中大型的组网配置）"><a href="#三层组网（AC-与-AP-处于不同网段，中大型的组网配置）" class="headerlink" title="三层组网（AC 与 AP 处于不同网段，中大型的组网配置）"></a>三层组网（AC 与 AP 处于不同网段，中大型的组网配置）</h1><h2 id="1-交换设备创建-VLAN（分别为业务-VLAN、管理-VLAN）"><a href="#1-交换设备创建-VLAN（分别为业务-VLAN、管理-VLAN）" class="headerlink" title="1. 交换设备创建 VLAN（分别为业务 VLAN、管理 VLAN）"></a>1. 交换设备创建 VLAN（分别为业务 VLAN、管理 VLAN）</h2><p> 管理 VLAN：200（给 AP 分配 IP 地址）		</p>
<ol>
<li>业务 VLAN：10、20、30（给终端用户分配 IP 地址）<br> 配置命令：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vlan  batch   10   20   30    200			// 创建管理 VLAN 和相关的业务 VLAN<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>配置地址池</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vlan pool vlan10<br>network  192.168.10.0  mask  24<br>gateway-list 192.168.10.254<br><br>vlan pool vlan20<br>network  192.168.20.0  mask  24<br>gateway-list 192.168.20.254<br><br>vlan pool vlan30<br>network  192.168.30.0  mask  24		// 分别创建 3 个业务地址池<br>gateway-list 192.168.30.254			// 指定网关地址<br><br>vlan pool vlan200<br>network  200.1.1.0  mask  24			// 创建业务地址池<br>gateway-list  200.1.1.254			// 指定网关地址<br>option 43 sub-option 1 ip-address 100.1.1.1	// 配置选项字段 43（指定 AC 设备的 IP 地址，通过单播方式访问）<br>					    默认采用广播，但不同 VLAN 的设备无法广播互访，所以需要手工指定 AC 的 IP 地址<br></code></pre></td></tr></table></figure>
<p>交换设备需要配置三层网关接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">interface vlanif10<br>ip address 192.168.10.254  24<br>dhcp select global				// 创建三层接口，调用全局地址池<br><br>interface vlanif20<br>ip address 192.168.20.254  24<br>dhcp select global<br><br>interface vlanif30<br>ip address 192.168.30.254  24<br>dhcp select global<br><br>interface vlanif200<br>ip address 200.1.1.254  24<br>dhcp select global<br></code></pre></td></tr></table></figure>

<h2 id="2-交换设备的接口需要放行-VLAN"><a href="#2-交换设备的接口需要放行-VLAN" class="headerlink" title="2. 交换设备的接口需要放行 VLAN"></a>2. 交换设备的接口需要放行 VLAN</h2><ol>
<li>进入 LSW 与 AP 互联的接口</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">interface G0/0/X<br>port link-type trunk<br>port trunk  allow-pass   vlan   10  20  30  200		// 配置为 Trunk 接口，并放行相关的管理 VLAN 和业务 VLAN <br>port trunk pvid  vlan  200				// 配置 PVID 使得 AP 能够通过 VLANIF 200 获取 IP 地址<br></code></pre></td></tr></table></figure>
<p>AP 设备上使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">display  ip  interface  brief   		// 查看 AP 设备是否获取到 IP 地址即可<br></code></pre></td></tr></table></figure>

<h2 id="3-AC-与-AP-可以实现互通"><a href="#3-AC-与-AP-可以实现互通" class="headerlink" title="3. AC 与 AP 可以实现互通"></a>3. AC 与 AP 可以实现互通</h2><ol>
<li>AC 设备上配置 IP 地址</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vlan 100<br>interface  Vlanif100<br>ip address  100.1.1.1  24				// 设置 AC 的通信地址<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>AC 接口需要放行 VLAN</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">interface G0/0/X					// 进入 AC 与交换机互联的接口<br>port link-type trunk<br>port trunk allow-pass vlan 10 20 30 100			// 需要放行业务 VLAN 和通信 VLAN<br>							（业务 VLAN 提前放行，用于后续配置 VLAN POOL）<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>交换设备与 AC 互联的接口也需要放行 VLAN，并且配置相同网段的地址</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vlan 100<br>interface  Vlanif100<br>ip address  100.1.1.254  24				// 设置交换设备与 AC 通信的地址<br></code></pre></td></tr></table></figure>
<ul>
<li>接口需要放行 VLAN</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">interface G0/0/X					// 进入 AC 与交换机互联的接口<br>port link-type trunk<br>port trunk allow-pass vlan 10 20 30 100			// 需要放行业务 VLAN 和通信 VLAN<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>AC 需要配置路由条目访问 AP</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ip route-static  200.1.1.0  24  100.1.1.254			// 访问 AP，下一跳指定为：LSW 的接口 IP 地址	<br></code></pre></td></tr></table></figure>
<p>配置完成后，可以在 AP 或者 AC 上 ping 对方进行测试</p>
<h2 id="4-AP-注册上线"><a href="#4-AP-注册上线" class="headerlink" title="4. AP 注册上线"></a>4. AP 注册上线</h2><ol>
<li>AC 设备上，需要指定 CAPWAP 隧道源的 IP 地址</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">capwap source ip-address 100.1.1.1	<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>AC 设备还需要根据 AP 的 MAC 来进行注册（AC 配置）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">wlan					// 进入 WLAN 视图<br>ap-id 1 ap-mac  XXXX-XXXX-XXXX		// 把 AP 的 MAC 地址绑定到 AP-ID 中<br>```						（进入 AP  使用：display  interface  vlanif 可以获取 AP 的 MAC 地址）<br></code></pre></td></tr></table></figure>
<p>配置完成后，在 AC 上使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">display  ap  all		// AP 的状态为 nor 代表上线成功<br></code></pre></td></tr></table></figure>

<h2 id="5-配置-AC-的业务"><a href="#5-配置-AC-的业务" class="headerlink" title="5. 配置 AC 的业务"></a>5. 配置 AC 的业务</h2><ol>
<li>AC 设备需要把服务 VLAN 划入到 VLAN POOL 中</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vlan batch  10 20 30				// 创建 VLAN（10、20、30）业务 VLAN<br>vlan pool  A				// 创建 VLAN 池，名称：A<br>vlan  10  20  30				// VLAN 池包含的服务 VLAN 有（10、20、30）<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>进入 WLAN 视图，创建三个模板（SSID、安全、VAP）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ssid-profile name A				// 创建 SSID 模板<br>ssid  office				// 设置 SSID 名称（wifi 信号覆盖范围标识）office<br>					（quit 返回 WLAN 视图，创建下一个模板）<br><br>security-profile name A			// 设置安全模板，名称：A<br>security wpa2 psk pass-phrase 12345678 aes	// 设置 WPA2 认证，AES 加密的密码，密码：12345678<br>					（quit 返回 WLAN 视图，创建下一个模板）<br><br>vap-profile name A				// 创建 VAP 模板，名称：A<br>service-vlan vlan-pool A			// 使用服务 VLAN POOL A（10、20、30）<br>ssid-profile A				// 使用的 SSID 名称：office<br>security-profile A				// 使用密码：12345678<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>返回 WLAN 视图，绑定 VAP 到 AP 设备上</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ap-id 1<br>vap-profile  A wlan  1  radio 0			// 进入 AP-ID 1，调用 VAP 模板：A，使用 wlan 编号 1（radio 0 代表  2.4GHz）<br>						（1 和 2 则为 5GHz）<br></code></pre></td></tr></table></figure>
<p>如果出现相关的信号圈，则代表配置成功</p>
<h2 id="6-如果需要配置漫游，则额外添加一个-AP-设备，并参考一下配置"><a href="#6-如果需要配置漫游，则额外添加一个-AP-设备，并参考一下配置" class="headerlink" title="6. 如果需要配置漫游，则额外添加一个 AP 设备，并参考一下配置"></a>6. 如果需要配置漫游，则额外添加一个 AP 设备，并参考一下配置</h2><p>交换设备与新的 AP 互联接口，需要放行 VLAN</p>
<ol>
<li>进入 LSW 与 AP 互联的接口</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">interface G0/0/X<br>port link-type trunk<br>port trunk  allow-pass   vlan   10  20  30  200		// 配置为 Trunk 接口，并放行相关的管理 VLAN 和业务 VLAN <br>port trunk pvid  vlan  200				// 配置 PVID 使得 AP 能够通过 VLANIF 200 获取 IP 地址<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>AC 上配置（AP 上线）<br>AP 上线（AC 需要对 AP 的身份做认证，默认为：MAC 认证）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">wlan						// 进入 WLAN 视图<br>ap-id 2 ap-mac  XXXX-XXXX-XXXX			// 把 AP 的 MAC 地址绑定到 AP-ID 2 中（更换 AP ID 为 2）<br>								MAC 地址为新接入 AP 的 MAC<br>查看 AP 是否上线，AC 上 display  ap   all			// 状态为 nor（代表上线成功）<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>新 AP 调用相同的模板</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ap-id 2<br>vap-profile  A wlan  2  radio 0			// 进入 AP-ID 2，调用 VAP 模板：A，使用 wlan 编号 2（radio 0 代表  2.4GHz）						（1 和 2 则为 5GHz）<br></code></pre></td></tr></table></figure>
<p>出现信号圈代表上线成功和配置成功<br>测试漫游  STA 接入 AP 后，</p>
<pre><code>ping 网关 -t		// ping 地址 -t  会一直进行访问，访问时，把 STA 在不同的 AP 覆盖范围内移动，查看数据是否中断
```						（一般 1-2 个数据包，或不中断代表漫游成功）
</code></pre>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/11/15/16.ACL/">← 下一篇 15.ACL基础</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/11/13/13.Datacom/">13.网路服务 上一篇 →</a></div></div></div><div id="comments"><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/SAO.png" alt="Logo"></a><h1 id="Dr"><a href="/">LFSW元立</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/LongFengShuanWu"><i class="fab fa-github" alt="Github"></i></a><a class="social" target="_blank" rel="noopener" href="https://space.bilibili.com/200274416"><i class="fa-brands fa-bilibili" alt="BiliBili"></i></a><a class="social" target="_blank" rel="noopener" href="https://www.zhihu.com/people/lfswyuan-li"><i class="fab fa-zhihu" alt="Zhihu"></i></a><a class="social" href="jun@yuanli-lfsw.com"><i class="fa fa-envelope" alt="E-Mail"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">组网概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">工作过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-AP-%E4%B8%8E-AC-%E5%BB%BA%E7%AB%8B-CAPWAP-%E9%9A%A7%E9%81%93"><span class="toc-number">2.1.</span> <span class="toc-text">1. AP 与 AC 建立 CAPWAP 隧道</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-AP-%E8%AE%BE%E5%A4%87%E9%9C%80%E8%A6%81%E5%85%88%E9%80%9A%E8%BF%87-DHCP-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%88%96%E8%80%85-IP-%E5%9C%B0%E5%9D%80%E4%BF%A1%E6%81%AF"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.  AP 设备需要先通过 DHCP 服务器或者 IP 地址信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A%EF%BC%88%E6%8E%A5%E5%85%A5%E4%BA%A4%E6%8D%A2%E8%AE%BE%E5%A4%87%EF%BC%89"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">配置命令：（接入交换设备）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BA%A4%E6%8D%A2%E6%9C%BA%E8%BF%9E%E6%8E%A5-AP-%E7%9A%84%E6%8E%A5%E5%8F%A3%E9%9C%80%E8%A6%81%E6%94%BE%E8%A1%8C%E7%9B%B8%E5%85%B3-VLAN%EF%BC%8C%E4%BF%9D%E8%AF%81%E6%8E%A5%E5%85%A5%E7%9A%84-AP-%E8%AE%BE%E5%A4%87%E8%83%BD%E5%A4%9F%E8%8E%B7%E5%8F%96%E5%88%B0-IP-%E5%9C%B0%E5%9D%80"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.  交换机连接 AP 的接口需要放行相关 VLAN，保证接入的 AP 设备能够获取到 IP 地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A%E8%BF%9B%E5%85%A5%EF%BC%88LSW-%E4%B8%8E-AP-%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">配置命令：进入（LSW 与 AP 连接的接口）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-AC-%E8%AE%BE%E5%A4%87%E9%9C%80%E8%A6%81%E6%89%8B%E5%B7%A5%E9%85%8D%E7%BD%AE-IP-%E5%9C%B0%E5%9D%80%EF%BC%88%E5%A6%82%EF%BC%9A%E4%BA%8C%E5%B1%82%E7%BB%84%E7%BD%91%EF%BC%89%E5%88%99%E5%9C%A8-VLANIF-10-%E4%B8%AD%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%90%8C%E7%BD%91%E6%AE%B5%E7%9A%84-IP-%E5%9C%B0%E5%9D%80%E5%B9%B6%E4%B8%94AC%E3%80%81%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%BB%A5%E5%8F%8A%E4%B8%8E-AP-%E4%BA%92%E8%81%94%E7%9A%84%E7%AB%AF%E5%8F%A3%E9%83%BD%E8%A6%81%E6%94%BE%E8%A1%8C-VLAN-10%EF%BC%88%E4%BF%9D%E9%9A%9C-AP-%E8%83%BD%E4%B8%8E-AC-%E9%80%9A%E4%BF%A1%EF%BC%89"><span class="toc-number">2.1.3.</span> <span class="toc-text">3. AC 设备需要手工配置 IP 地址（如：二层组网）则在 VLANIF 10 中配置相同网段的 IP 地址并且AC、交换机以及与 AP 互联的端口都要放行 VLAN 10（保障 AP 能与 AC 通信）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A%EF%BC%88AC%EF%BC%89"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">配置命令：（AC）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-AC-%E8%AE%BE%E5%A4%87%E8%AE%BE%E7%BD%AE-CAPWAP-%E7%9A%84%E9%9A%A7%E9%81%93%E6%BA%90-IP-%E5%9C%B0%E5%9D%80%EF%BC%88%E6%88%96%E8%80%85%E6%8E%A5%E5%8F%A3%EF%BC%89%E7%94%A8%E4%BA%8E-AC-%E4%B8%8E-AP-%E4%B9%8B%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-number">2.1.4.</span> <span class="toc-text">4. AC 设备设置 CAPWAP 的隧道源 IP 地址（或者接口）用于 AC 与 AP 之间通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A%EF%BC%88AC%EF%BC%89-1"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">配置命令：（AC）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-AC-%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87-VAP-%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%90%91-AP-%E4%B8%8B%E5%8F%91%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%E5%92%8C%E6%8E%A7%E5%88%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.</span> <span class="toc-text">2. AC 可以通过 VAP 的配置，向 AP 下发配置命令和控制信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AC-%E4%B8%8B%E5%8F%91%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.1.</span> <span class="toc-text">AC 下发配置信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E5%B1%82%E7%BB%84%E7%BD%91%EF%BC%88AC-%E4%B8%8E-AP-%E5%A4%84%E4%BA%8E%E4%B8%8D%E5%90%8C%E7%BD%91%E6%AE%B5%EF%BC%8C%E4%B8%AD%E5%A4%A7%E5%9E%8B%E7%9A%84%E7%BB%84%E7%BD%91%E9%85%8D%E7%BD%AE%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">三层组网（AC 与 AP 处于不同网段，中大型的组网配置）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BA%A4%E6%8D%A2%E8%AE%BE%E5%A4%87%E5%88%9B%E5%BB%BA-VLAN%EF%BC%88%E5%88%86%E5%88%AB%E4%B8%BA%E4%B8%9A%E5%8A%A1-VLAN%E3%80%81%E7%AE%A1%E7%90%86-VLAN%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">1. 交换设备创建 VLAN（分别为业务 VLAN、管理 VLAN）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%A4%E6%8D%A2%E8%AE%BE%E5%A4%87%E7%9A%84%E6%8E%A5%E5%8F%A3%E9%9C%80%E8%A6%81%E6%94%BE%E8%A1%8C-VLAN"><span class="toc-number">3.2.</span> <span class="toc-text">2. 交换设备的接口需要放行 VLAN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-AC-%E4%B8%8E-AP-%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E4%BA%92%E9%80%9A"><span class="toc-number">3.3.</span> <span class="toc-text">3. AC 与 AP 可以实现互通</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-AP-%E6%B3%A8%E5%86%8C%E4%B8%8A%E7%BA%BF"><span class="toc-number">3.4.</span> <span class="toc-text">4. AP 注册上线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE-AC-%E7%9A%84%E4%B8%9A%E5%8A%A1"><span class="toc-number">3.5.</span> <span class="toc-text">5. 配置 AC 的业务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E6%BC%AB%E6%B8%B8%EF%BC%8C%E5%88%99%E9%A2%9D%E5%A4%96%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA-AP-%E8%AE%BE%E5%A4%87%EF%BC%8C%E5%B9%B6%E5%8F%82%E8%80%83%E4%B8%80%E4%B8%8B%E9%85%8D%E7%BD%AE"><span class="toc-number">3.6.</span> <span class="toc-text">6. 如果需要配置漫游，则额外添加一个 AP 设备，并参考一下配置</span></a></li></ol></li></ol></div></div><footer><nobr><span class="icp-title">ICP</span><a class="icp-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">用github托管不就图个不用icp备案</a></nobr><br><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> 主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>